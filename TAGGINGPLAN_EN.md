# Android SDK Tagging Plan

## Tracking a WebView application

For navigation within an Android *WebView* application (standard HTML/JS website), our internal identifier must be provided in the launch URL to ensure tracking continuity.
To retrieve this value, the client-side technique must call the following function defined in our SDK:

*Android* :

```xml
String euidl = EAnalytics.getEUIDL();
```

Once this value is supplied in the **ea-euidl-bypass** parameter, the usual cookie system is disabled and the EUIDL coming from the application is used instead.

**Example:**

```xml
http://www.demo.fr/android-landing-webview?ea-euidl-bypass=$euidl_de_l_app
```

If **ea.js** detects this parameter, it uses it and stores it internally for the entire session, so the site doesn’t have to resend it on every visited page.
After this parameter is passed, tracking an Android application in a WebView context is no different from the JavaScript formats we use for a standard website.

**IMPORTANT**: The `"ea-euidl-bypass"` parameter must always be supplied (every time the URL changes); otherwise, the link between app and web navigation will be lost.

**IMPORTANT**: In a **WebView** application, you must add the **`edev`** parameter when opening the WebView. This parameter **qualifies the traffic as coming from a native application**.

It is essential to ensure proper **in-app campaign** and **push notification** tracking, as well as accurate **WebView call attribution**.

Accepted values for the `edev` parameter are:

* `AppNativeIOSphone`
* `AppNativeIOStablet`
* `AppNativeAndroidphone`
* `AppNativeAndroidtablet`

## Tracking a native application

In a native application, our SDK must be integrated into the app’s source code to include the following type of marker:

```xml
EAProperties properties = new EAProperties.Builder("PAGE_NAME”).build();
Eanalytics.getInstance().track(properties);
```

Our **SDK** is designed to simplify integration as much as possible by offering an easy-to-use object structure and detailed documentation.

The available parameters and capabilities are exactly the same as for our Tag Collector. You can therefore track navigation paths in your application and compare them with your classic website by integrating the same variables.

Calls generated by these markers are also very close to the classic Collector call and are designed to be as lightweight as possible so they don’t interfere with the application.

Some Collector parameters are specific to mobile-app tracking. For more information, see [this documentation](https://eulerian.wiki/doku.php?id=fr:modules:collect:onsite_collection:taggingplan_web&s[]=webview#tab__mobiles).

Our SDK can also collect an unlimited number of offline interactions and send them once the user reconnects. This allows us to continue tracking the user even when they interact with your application offline. Navigation is recorded and later reassigned using our `ereplay-time` parameter.

## Traffic attribution rule

On a standard website, our system identifies and attributes traffic based on the **URL** on which the marker is called. However, we do not have access to this information in an application context.

To define the traffic-attribution rule, we therefore rely on the tracking sub-domain used and passed as a parameter to the **init** method of the `EAnalytics` object defined in our SDK:

```xml
public class YourApp extends Application {
     @Override
    public void onCreate() {
        super.onCreate();
        EAnalytics.init(this, "TRACKING_DOMAIN", true);
    }
 }
```

<note important>
This also means that if you use the same tracking sub-domain for several of your applications, we will need to distinguish them by adding the [from](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list) parameter in the markers. This is automatically the case for a hybrid application that shares some pages with your website.
</note>

Note as well that the absence of a URL also means no default page name. The [path](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list) parameter is not optional but **mandatory** in application tracking.

Traffic generated by your application can be reported on a dedicated Eulerian site or merged with that of an existing website. As mentioned above, if your application switches to WebView mode for certain pages, adding the [from](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list) parameter is mandatory so we can redirect the traffic correctly in our systems.

## Download and update metrics

Parameter descriptions:

* **ea-appname** : `APPLICATION_NAME` – the name of the application (must not change)
* **ea-appversion** : `APPLICATION_VERSION` – the version of the application
* **ea-appinstalled** : `1` – indicates that a new installation should **not** be counted for this call.
  It is used to handle initialization of users who already had the application before Eulerian integration.
  This parameter can be supplied permanently, alongside `appversion` and `appname`, as long as the application considers it has already been launched previously on this device/user.

The presence of the **ea-appname** parameter triggers processing in the system.

The system feeds the **Download** metric if:

* The user has never been exposed to the **ea-appname** value when the application opens **and** the **ea-appinstalled** parameter is not present in the call.

The system feeds the **Update** metric if:

* The user has already been exposed to the **ea-appname** parameter and its value is identical to that seen at the last application launch, **but** the **ea-appversion** value is different.

## Integration via JitPack

For mobile-app tracking, **JitPack** simplifies the SDK integration process.

### Installation

Add JitPack in the build file:

```groovy
allprojects {
    repositories {
        ...
        maven { url 'https://jitpack.io' }
    }
}
```

Insert the Android SDK into [Gradle](http://gradle.org/|Gradle):

```xml
dependencies {
   compile 'com.eulerian.android.sdk:eanalytics:1.9.0'
}
```

In the **AndroidManifest.xml** file, add the following permissions:

```javascript
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
```

In the same file, add the following code for download tracking:

```javascript
<receiver
   android:name="com.eulerian.android.sdk.InstallReferrerReceiver"
   android:exported="true">
   <intent-filter>
      <action android:name="com.android.vending.INSTALL_REFERRER" />
   </intent-filter>
</receiver>
```

## Starting Eulerian Analytics

Before using the SDK, make sure to initialize it with the **onCreate()** function below.

```javascript
<!-- in your AndroidManifest.xml-->
<application
   android:name=".DemoApp">
```

```javascript
public class DemoApp extends Application {

    @Override
    public void onCreate() {
        super.onCreate();
        EAnalytics.init(this, "example.demo.com", false);
    }

}
```

You can now integrate any type of tags with their parameters. For example, the generic tag is identified by **EAProperties**. Other tag types each have a specific identifier (e.g., **EACart** for the cart, **EAEstimate** for the quote, **EAProducts** for the category, etc.).

```javascript
EASearch search = new EASearch.Builder("/path-example", "banana")
                .setParams(new Params.Builder()
                        .addParam("provenance", "martinique")
                        .addParam("couleur", "jaune")
                        .build())
                .setResults(42)
                .build();

EAnalytics.getInstance().track(search)
```

### Page List

* Generic Page
* Product Page
* Category Page
* Search Engine Page
* Error Page
* Quote Page
* Cart Page
* Order Page

# Generic Page

The marker below is generic and must be implemented on all site pages except for product pages, order, quote, and started cart pages. This notably includes the homepage and conversion funnel pages between the cart and order confirmation.

It allows you to track all site-centric traffic, page views and visits, as well as origin sources through natural levers such as direct access, organic search, or referrals.

We then manage all necessary actions remotely. Therefore, you do not need to change your page code to benefit from additional features.

You can add the following parameters in the generic format or to any of the collector tags described in this documentation to enrich your reports.

### Parameter List

* ****path :**** (PAGE\_NAME) This parameter allows you to name the page for identification in reports. For more details, refer to [this article](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).
* ****uid :**** (UID) This parameter must be populated with your internal ID when the user is logged in to consolidate the history across different devices. This allows you to reconcile a click with an app download. For more info, consult [this article](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).

### Implementation

The **EAProperties** object is the parent class that contains all internal or editable parameters of our Tag collector.

To add a new parameter, use one of the native **setKEY(VALUE)** methods or the generic method **set("KEY","VALUE")**.

****Example:****

```xml
EAProperties genericTag = new EAProperties.Builder(path: String)
                        .setPageGroup(String)
                        .setUID(String)
                        .setEmail(String)
                        .setProfile(String)
                        .set(String - KEY,String - VALUE)
                        .build();
EAnalytics.getInstance().track(genericTag);
```

****With values:****

```xml
EAProperties genericTag = new EAProperties.Builder("PAGE_NAME")
                        .setPageGroup("MY-PAGEGROUP")
                        .setUID("123asd")
                        .setEmail("test@test.fr")
                        .setProfile("visitor")
                        .set("KEY-CUSTOM-PARAMETER","VALUE")
                        .build();
EAnalytics.getInstance().track(genericTag);
```

# Product Page

This marker allows tracking of product page views and visits from your catalog. It feeds the reports available at:

* Site-centric > Products > **Product Acquisition & Performance**

You can also pass one or more product categories.

**Note:** A product page is considered any marker that includes one and only one product reference, without the **scart**, **estimate**, **ref**, and **amount** parameters. If a collector tag includes any of these parameters or multiple product references, it won't be interpreted as a product page.

## Parameter List

* ****path :**** (PAGE\_NAME) Required for report identification, must be set manually. More info [here](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).
* ****uid :**** (UID) Internal ID for logged-in users to consolidate cross-device history. More info [here](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).
* ****prdref :**** (PRODUCT\_ID) Must be set with the product reference viewed by the user. More info [here](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).
* ****prdname :**** (PRODUCT\_NAME) A readable product name for easier reporting. More info [here](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).
* ****prdgroup :**** (GROUP) Associates a group to a product (e.g., margin group "A" or "B"). Does not expose exact margin values. More info [here](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).
* ****prdparam-xxxxx :**** (PARAM\_NAME, PARAM\_VALUE) Assigns categories to product references. Specify the category after the prefix **prdparam-**. Examples: prdparam-universe, prdparam-size. You may add as many as needed. More info [here](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).

## Implementation

The **EAProducts** object is used for tracking product pages.

A product must be created with a **Product** object using the product reference. It can then be supplemented with a **Params** object to assign additional attributes.

****Example:****

```xml
Params paramProduct = new Params.Builder()
.addParam(String - key, String - Value)
.build();

Product product1 = new Product.Builder(String - prdref)
.setName(String - prdname)
.setGroup(String - prdgroup)
.setParams(paramProduct)
.build();

EAProducts productPage = new EAProducts.Builder("PAGE_NAME")
.setPageGroup(String)
.setUID(String)
.setEmail(String)
.setProfile(String)             
.addProduct(product1)
.build();

EAnalytics.getInstance().track(productPage);
```

****With values:****

```xml
Params paramProduct = new Params.Builder()
.addParam("category", "clothes")
.addParam("brand", "nike")
.build();

Product product1 = new Product.Builder("ref-product")
.setName("name-product")
.setGroup("group-product")
.setParams(paramProduct)
.build();

EAProducts productPage = new EAProducts.Builder("PAGE_NAME")
.setPageGroup("my-pagegroup")
.setUID("123asd")
.setEmail("test@test.fr")
.setProfile("looker")             
.addProduct(product1)
.build();

EAnalytics.getInstance().track(productPage);
```

# Category Page

This marker sends the top 3 product references listed on the result page to your partners to optimize retargeting. Its usage is mainly restricted to Eulerian TMS and does not impact the Acquisition & Product Performance report in Eulerian DDP.

**Note:** A result page is any marker containing multiple product references without the **scart**, **estimate**, **ref**, and **amount** parameters. If there's only one product reference (prdref), the marker is treated as a product page instead.

## Parameter List

* ****path :**** (PAGE\_NAME) Required for report identification, must be set manually. More info [here](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).
* ****uid :**** (UID) Internal ID for logged-in users to consolidate cross-device history. More info [here](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).
* ****prdref :**** (PRODUCT\_ID) Must be set with the product reference viewed by the user. More info [here](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list).

## Implementation

Use the **EAProducts** object and pass the first X products shown on the page.

Each product is created via a **Product** object. Once initialized and optionally completed with attributes, add it to **EAProducts** via the addProduct method.

****Example:****

```xml
Product product1 = new Product.Builder(String - product ref).build();
Product product2 = new Product.Builder(String - product ref).build();
Product product3 = new Product.Builder(String - product ref).build();

EAProducts resultPage = new EAProducts.Builder(path: String)
.setPageGroup(String!)
.setUID(String!)
.setEmail(String!)             
.addProduct(Product product1)
.addProduct(Product product2)
.addProduct(Product product3)
.build();

EAnalytics.getInstance().track(resultPage);
```

****With values:****

```xml
Product product1 = new Product.Builder("ref-product1").build();
Product product2 = new Product.Builder("ref-product2").build();
Product product3 = new Product.Builder("ref-product3").build();

EAProducts resultPage = new EAProducts.Builder("page-name")
.setPageGroup("my-pagegroup")
.setUID("123asd")
.setEmail("test@test.fr")             
.addProduct(product1)
.addProduct(product2)
.addProduct(product3)
.build();

EAnalytics.getInstance().track(resultPage);
```

### Search Engine Page

The internal search engine marker allows you to capture queries entered by users along with an unlimited number of additional parameters. All this information is cross-referenced with the generated sales and activated acquisition levers during the session.

**Note:** A page is considered a search engine page if it contains the parameter **isearchengine**.

Note that this marker is not exclusive. If you include a product reference with the **prdref** parameter, the marker will also be treated as a product page.

#### Parameter List

* ****path :**** (PAGE\_NAME) Allows page identification in reports. Must be manually set. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****uid :**** (UID) Internal ID when user is logged in for cross-device tracking. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****isearchengine :**** (ENGINE\_NAME) Identifies the internal engine name to distinguish among multiple search fields. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****isearchresults :**** (RESULT\_COUNT) Number of search results returned. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****isearchkey :**** (SEARCH\_PARAM\_KEY) Key for additional search field. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****isearchdata :**** (SEARCH\_PARAM\_VALUE) Value corresponding to isearchkey. For each additional field, add another isearchkey/isearchdata pair. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)

#### Implementation

Use the **EASearch** class for internal search engine tracking. Create a **Params** object and use **addParam** for each key-value pair.

****Example:****

```xml
Params param1 = new Params()
.addParam("SEARCH_PARAM_KEY_1","SEARCH_PARAM_VALUE_1")
.addParam("SEARCH_PARAM_KEY_2","SEARCH_PARAM_VALUE_2")
.addParam("SEARCH_PARAM_KEY_3","SEARCH_PARAM_VALUE_3")
.build();

EASearch searchPage = new EASearch.Builder("PAGE_NAME", "ENGINE_NAME")
.setUID("UID")
.setResults(RESULT_COUNT)
.setParams(param1)
.build();

EAnalytics.getInstance().track(searchPage);
```

****With values:****

```xml
Params param1 = new Params()
.addParam("keyword","jacket")
.addParam("min_price","100.00")
.addParam("max_price","400.00")
.build();

EASearch searchPage = new EASearch.Builder("InternalSearch|jacket", "internal_engine")
.setUID("34678")
.setResults(150)
.setParams(Params)
.build();

EAnalytics.getInstance().track(searchPage);
```

---

### 404 Error Page

The **error** marker indicates that the site's application has generated a 404 error page. It feeds reports such as:

* Site-centric > Audience Analysis > By Page > **Error Page**

This tag captures all URLs that triggered a 404 and helps you redirect traffic appropriately.

Use it to get alerts for recurring problems in your conversion funnel.

#### Parameter List

* ****error :**** Always set to **1** and can be added to any marker type. It logs a page view in the relevant report. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****path :**** (PAGE\_NAME) Required for identification in reports. Must be manually set. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)

#### Implementation

Use the **set** method with the key **error** to flag the error page.

****Example:****

```xml
EAProperties errorTag = new EAProperties.Builder("error|404")
.set("error","1")
.build();
Eanalytics.getInstance().track(errorTag);
```

---

### Quote Page

This marker tracks quotes and all related information:

* Products involved
* Quote type
* Total amount
* Contextual data

Each new quote includes acquisition levers and navigation history.

**Note:** Quotes are deduplicated using the reference provided. Using the same reference for different quotes will ignore the second instance.

**Note:** A page is considered a quote page if it contains both **ref** and **estimate** parameters.

#### Parameter List

* ****path :**** (PAGE\_NAME) Required for report identification. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****uid :**** (UID) Internal ID for logged-in users. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****ref :**** (QUOTE\_REFERENCE) Unique reference for the quote. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****amount :**** (QUOTE\_AMOUNT) Total quote amount in decimal. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****type :**** (QUOTE\_TYPE) Allows categorization per your taxonomy. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****prdref :**** (PRODUCT\_ID) Product reference in the quote. Repeat for each product. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****prdamount :**** (PRODUCT\_AMOUNT) Unit price per product in the quote. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****prdquantity :**** (PRODUCT\_QUANTITY) Quantity per product in the quote. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)

#### Implementation

Use the **EAEstimate** object for quote page tracking. Add each product via **Product** and include it using **addProduct**.

****Example:****

```xml
Product product1 = new Product.Builder(String - id-product).build();
Product product2 = new Product.Builder(String - id-product).build();

EAEstimate estimatePage = new EAEstimate.Builder(String - page-name, String - id-estimate)
.setPageGroup(String!)
.setUID(String!)
.setEmail(String!) 
.setType(String!)
.setAmount(Double!)
.set(String key, String value)
.addProduct(Product product, Double amount, Int quantity)
.addProduct(Product product, Double amount, Int quantity)
.build();

EAnalytics.getInstance().track(estimatePage);
```

****With values:****

```xml
Product product1 = new Product.Builder("505").build();

EAEstimate estimatePage = new EAEstimate.Builder("Credit|quote", "C4536567")
.setPageGroup("my-pagegroup")
.setUID("123asd")
.setEmail("test@test.fr") 
.setAmount(5000.00)
.setType("Credit_48months")
.set("custom-param-KEY", "custom-param-value")
.addProduct(product1, 5000.00, 1)
.build();

EAnalytics.getInstance().track(estimatePage);
```

---

### Cart Page

This marker tracks started carts and helps calculate conversion and abandonment rates.

You can also include products and their categories in the cart along with amounts and quantities. These parameters feed the product reports:

* Site-centric > Products > **Product Acquisition & Performance**

A cart's lifetime is 30 rolling minutes, i.e., the user's session.

**Note:** A page is considered a cart page if it includes the **scart** parameter.

#### Parameter List

* ****path :**** (PAGE\_NAME) For page identification in reports. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****uid :**** (UID) Internal ID for logged-in users. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****scartcumul :**** (0\_OR\_1) If 0, passed products represent the full cart. If 1, they are added cumulatively. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****prdref :**** (PRODUCT\_ID) Product reference, repeated for each product. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****prdamount :**** (PRODUCT\_AMOUNT) Unit price per product in cart. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****prdquantity :**** (PRODUCT\_QUANTITY) Quantity per product in cart. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)

#### Implementation

Use **EACart** to track the cart page. Each product is created via **Product** and added using **addProduct**.

****Example:****

```xml
Params paramProduct = new Params.Builder()
.addParam(String Key, String value)
.addParam(StringKey, String value)
.build();

Product product1 = new Product.Builder(String ref-product)
.setName(String!)
.setParams(paramProduct)
.build();

EACart cartPage = new EACart.Builder(String path)
.setPageGroup(String!)
.setUID(String!)
.setEmail(String!) 
.setProfile(String!)
.setCartCumul(Bool!) 
.addProduct(product1, Double amount, Int quantity)
.build();

EAnalytics.getInstance().track(cartPage);
```

****With values:****

```xml
Params paramProduct = new Params.Builder()
.addParam("category", "T-Shirt")
.addParam("brand", "Nike")
.build();

Product product1 = new Product.Builder("product-123")
.setName("product-name")
.setParams(paramProduct)
.build();

EACart cartPage = new EACart.Builder("page-name")
.setPageGroup("my-page-group")
.setUID("123asd")
.setEmail("test@test.fr") 
.setProfile("shopper")
.setCartCumul(true) 
.addProduct(product1, 50.30, 2)
.build();

EAnalytics.getInstance().track(cartPage);
```

### Order Page

This marker records conversions and enables ROI calculation for all your marketing channels. In addition to the total order amount, you can include associated products, payment method, currency, or sale type. These details enrich reporting capabilities across the Eulerian suite. Each conversion is detailed with its acquisition levers and navigation history.

**Note:** Orders are deduplicated based on the reference provided in the sales marker.

If the same reference is used for two different orders, the second one is ignored due to the uniqueness principle.

Eulerian Analytics allows cancellation of orders to more accurately measure campaign performance over time. It's recommended to trigger the order marker as early as possible in the purchase process, provided required details (reference, amount, payment type, etc.) are available.

If the payment platform does not redirect the user back to your site, a tag placed after the payment platform may not be triggered.

**Note:** Aside from the order status (pending, valid, or invalid), it is not possible to redefine an order's contents after recording. You cannot add or remove products, but you can change the total amount.

**Note:** A page is considered an order confirmation page if it contains both **ref** and **amount** but excludes **scart** and **estimate**.

#### Parameter List

* ****path :**** (PAGE\_NAME) For identification in reports. Must be manually set. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****uid :**** (UID) Internal ID when user is logged in. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****ref :**** (ORDER\_REFERENCE) Unique reference for the order. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****amount :**** (ORDER\_AMOUNT) Total order amount (tax included, excluding shipping). Use dot for decimals. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****payment :**** (PAYMENT\_METHOD) Indicates the payment type used. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****type :**** (ORDER\_TYPE) Allows sale categorization using your taxonomy. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****currency :**** (CURRENCY) Converts the amount if different from configured default. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****profile :**** (PROFILE) Can be used to differentiate between new and returning customers. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****prdref :**** (PRODUCT\_ID) Ordered product references. Repeat for each. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****prdamount :**** (PRODUCT\_AMOUNT) Unit price for each ordered product. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)
* ****prdquantity :**** (PRODUCT\_QUANTITY) Quantity per ordered product. [More info](https://eulerian.wiki/doku.php?id=fr:collect:technical_implementation:parameters_list)

#### Implementation

Use the **EAOrder** class for order tracking. Each product must be created via a **Product** object and added using **addProduct**.

****Example:****

```xml
Params paramProduct = new Params.Builder()
.addParam(String Key, String value)
.addParam(StringKey, String value)
.build();

Product product1 = new Product.Builder(String ref-product)
.setName(String!)
.setParams(paramProduct)
.build();

EAOrder orderPage = new EAOrder.Builder(String path, String id-sale)
.setPageGroup(String!)
.setUID(String!)
.setEmail(String!) 
.setProfile(String!)
.setNewCustomer(Bool!)
.setAmount(Double!)
.setType(String!)
.setPayment(String!)
.setCurrency(String!)
.setEstimateRef(String!)
.set("custom-param-key", "custom-param-value")
.addProduct(product1, Double amount, Int quantity)
.build();

EAnalytics.getInstance().track(orderPage);
```

****With values:****

```xml
Params paramProduct = new Params.Builder()
.addParam("category", "T-Shirt")
.addParam("brand", "Nike")
.build();

Product product1 = new Product.Builder("product-123")
.setName("product-name")
.setParams(paramProduct)
.build();

EAOrder orderPage = new EAOrder.Builder("Tunnel|Confirmation", "F654335671")
.setPageGroup("my-pagegroup")
.setUID("123asd")
.setEmail("test@test.fr") 
.setProfile("buyer")
.setNewCustomer(true)
.setAmount(50.30)
.setType("online")
.setPayment("credit card")
.setCurrency("EUR")
.setEstimateRef("asd123qwe")
.set("custom-param-key", "custom-param-value")
.addProduct(product1, 25.15, 2)
.build();

EAnalytics.getInstance().track(orderPage);
```

---

### Context Flag (CFLAG)

The **SiteCentricCFlag** object is dedicated to context flagging.

You can create one or more context flags using the **SiteCentricCFlag** object and add them with the `.setCFlag()` function inside any Eulerian tag. The `.set()` function takes the arguments `"string key", "string...value"`, with one or more values (up to a maximum of 10).

****Example:****

```xml
import com.eulerian.android.sdk.SiteCentricCFlag;

// Example for a generic tag
EAProperties genericTag = new EAProperties.Builder(path) //path
                        .setUID(UID) // UID
                        .setEmail("email")
                        .setProfile("profile")
                        .set("CUSTOM_PARAM_NAME","CUSTOM_PARAM_VALUE")
                        .set("CUSTOM_PARAM_NAME","CUSTOM_PARAM_VALUE")
                        .setCFlag(new SiteCentricCFlag.Builder()
                                .set("category_1", "rolandgarros", "wimbledon")
                                .set("category_2", "tennis")
                                .set("category_3", "usopen")
                                .build())
                        .build();

EAnalytics.getInstance().track(genericTag);
```

---

### Consent in an Android App (GDPR / RGPD)

> **Important: There are two MUTUALLY EXCLUSIVE approaches.**
> Choose **one or the other**, never both:
>
> 1. **TCF v2 Mode – TCString**: transmit the consent string via `gdpr_consent`.
> 2. **Category Mode – `pmcat`**: transmit the IDs of the refused categories.

---

#### 1. **TCF v2 Mode** — `gdpr_consent` parameter

Send the **TCString** generated by your CMP precisely when the user opts in or out. Send it **once per visitor**.

****Android Example:****

```xml
// Android – without values
EAProperties genericTag = new EAProperties.Builder("PAGE_NAME")
.setUID("UID")
.set("CUSTOM_PARAM_NAME","CUSTOM_PARAM_VALUE")
.set("gdpr_consent","TCSTRING")
.build();
EAnalytics.getInstance().track(genericTag);
```

```xml
// Android – with values
EAProperties genericTag = new EAProperties.Builder("|universe|section|page")
.setUID("5434742")
.set("subscription","monthly")
.set("gdpr_consent","EADURF214345")
.build();
EAnalytics.getInstance().track(genericTag);
```

---

#### 2. **Category Mode** — `pmcat` parameter

If you don't want to handle the TCString, use the `pmcat` parameter to list the **Eulerian IDs** of categories **refused** by the user, separated by dashes (`-`).

*Send `-` if the user accepts all categories.*

****Mapping Example:****

| Category    | Eulerian ID |
| ----------- | ----------- |
| analytics   | 1           |
| advertising | 10          |
| functional  | 19          |

If the user refuses "analytics" **and** "advertising", the value will be: `1-10`.

****Android Examples:****

```xml
// Android – without values
EAProperties genericTag = new EAProperties.Builder("PAGE_NAME")
.setUID("UID")
.set("CUSTOM_PARAM_NAME","CUSTOM_PARAM_VALUE")
.set("pmcat","REFUSED CMP CATEGORIES")
.build();
EAnalytics.getInstance().track(genericTag);
```

```xml
// Android – with values
EAProperties genericTag = new EAProperties.Builder("|universe|section|page")
.setUID("5434742")
.set("subscription","monthly")
.set("pmcat","1-2")
.build();
EAnalytics.getInstance().track(genericTag);
```

---

### General Opt-out URL

To offer a full opt-out option, provide the following URL:

```
<collection_domain>/optout.html?url=your_domain
```

**Example:**

```
https://mj23.eulerian.com/optout.html?url=www.eulerian.com
```

Include this on your "Privacy / GDPR" page or inside your CMP.

---

### Summary

| Step          | TCF v2 Mode    | Category Mode        |
| ------------- | -------------- | -------------------- |
| Key Parameter | `gdpr_consent` | `pmcat`              |
| When to send? | On opt-in/out  | On opt-in/out        |
| Content       | TCString       | Refused IDs (or `-`) |
| Compatibility | TCF v2 CMP     | Custom / Non-TCF CMP |

**Never use both modes simultaneously in the same app.**
